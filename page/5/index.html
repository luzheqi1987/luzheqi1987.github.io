<!doctype html>



  



<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="http://resource.qn.jerkybible.com/blog/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<script src="https://use.fontawesome.com/f4fcbffa46.js"></script>
<!--<link href="http://resource.qn.jerkybible.com/blog/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />-->

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="jerkybible, 行走的轮子, java, c, c++, python, ruby, sicp, hexo, next, spring, ffmpeg, blog, qt, opencv, 博客, 音频, 视频, 编码, 解码, 编解码, 迁移, 轮子, 转" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="戒急用忍">
<meta property="og:type" content="website">
<meta property="og:title" content="行走的轮子">
<meta property="og:url" content="http://blog.jerkybible.com/page/5/index.html">
<meta property="og:site_name" content="行走的轮子">
<meta property="og:description" content="戒急用忍">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="行走的轮子">
<meta name="twitter:description" content="戒急用忍">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    },
    algolia: {
          applicationID: 'TQAF9AT4MZ',
          apiKey: '91f27cce56682c2525b0f9fbb867111a',
          indexName: 'hexoblog',
          hits: {"per_page":10},
          labels: {"input_placeholder":"搜索...","hits_empty":"未发现与 「${query}」相关的内容","hits_stats":"${hits} 条相关条目，使用了 ${time} 毫秒"}
    }
  };
</script>




  <link rel="canonical" href="http://blog.jerkybible.com/page/5/"/>

  <title> 行走的轮子 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?0dec9769c21972aef79776299d7801d0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">行走的轮子</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">戒急用忍</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-visited">
          <a href="/visited" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            到此一游
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>
    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/11/Spring 使用简单Demo进行源码调试（四）/" itemprop="url">
                  Spring 使用简单Demo进行源码调试（四）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-05-11T07:24:09+08:00" content="2015-05-11">
              2015-05-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Spring/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/05/11/Spring 使用简单Demo进行源码调试（四）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/05/11/Spring 使用简单Demo进行源码调试（四）/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2015/05/11/Spring 使用简单Demo进行源码调试（四）/" class="leancloud_visitors" data-flag-title="Spring 使用简单Demo进行源码调试（四）">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <!-- <span class="post-meta-item-text">阅读次数 </span> -->
               <span class="post-meta-item-text">❤ </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <blockquote>
<p>版权声明：本文为<a href="http://blog.jerkybible.com">博主</a>原创文章，<a href="http://blog.jerkybible.com">转载请注明出处</a>，谢谢!</p>
</blockquote>
<!-- indicate-the-source -->
<p>接上篇日志<a href="http://blog.jerkybible.com/2015/05/11/Spring 使用简单Demo进行源码调试（三）/">Spring 使用简单Demo进行源码调试（三）</a>继续。</p>
<p>第一步<br>展开loadBeanDefinitions(resources)。这个代码比较简单，是对每一个资源进行加载。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">loadBeanDefinitions</span><span class="params">(Resource... resources)</span> <span class="keyword">throws</span> BeanDefinitionStoreException </span>&#123;</div><div class="line">	Assert.notNull(resources, &amp;quot;Resource array must not be <span class="keyword">null</span>&amp;quot;);</div><div class="line">	<span class="keyword">int</span> counter = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span> (Resource resource : resources) &#123;</div><div class="line">		counter += loadBeanDefinitions(resource);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> counter;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>展开loadBeanDefinitions(resource)。这一步为从特定的XML文件中加载bean factory，使用EncodedResource包装传来的resource，然后进一步加载。EncodedResource结合特定编码的资源描述符或特定字符集用于阅读资源，这里的资源描述符和特定字符集都为。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</div><div class="line">	 * 从特定的XML文件中加载bean factory</div><div class="line">	public int loadBeanDefinitions(Resource resource) throws BeanDefinitionStoreException &#123;</div><div class="line">		return loadBeanDefinitions(new EncodedResource(resource));</div><div class="line">	&#125;</span></div></pre></td></tr></table></figure></p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2015/05/11/Spring 使用简单Demo进行源码调试（四）/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/11/Spring 使用简单Demo进行源码调试（三）/" itemprop="url">
                  Spring 使用简单Demo进行源码调试（三）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-05-11T02:45:38+08:00" content="2015-05-11">
              2015-05-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Spring/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/05/11/Spring 使用简单Demo进行源码调试（三）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/05/11/Spring 使用简单Demo进行源码调试（三）/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2015/05/11/Spring 使用简单Demo进行源码调试（三）/" class="leancloud_visitors" data-flag-title="Spring 使用简单Demo进行源码调试（三）">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <!-- <span class="post-meta-item-text">阅读次数 </span> -->
               <span class="post-meta-item-text">❤ </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <blockquote>
<p>版权声明：本文为<a href="http://blog.jerkybible.com">博主</a>原创文章，<a href="http://blog.jerkybible.com">转载请注明出处</a>，谢谢!</p>
</blockquote>
<!-- indicate-the-source -->
<p>接上篇日志<a href="http://blog.jerkybible.com/2015/05/09/Spring 使用简单Demo进行源码调试（二）/">Spring 使用简单Demo进行源码调试（二）</a>继续。</p>
<p>上篇提到了主要的初始化函数refresh，函数源码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException </span>&#123;</div><div class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>.startupShutdownMonitor) &#123;</div><div class="line">            <span class="comment">// 为了刷新准备上下文</span></div><div class="line">            prepareRefresh();</div><div class="line"></div><div class="line">            <span class="comment">// 利用子类完成内部bean factory的刷新</span></div><div class="line">            ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();</div><div class="line"></div><div class="line">            <span class="comment">// 使用本地上下文准备bean factory</span></div><div class="line">            prepareBeanFactory(beanFactory);</div><div class="line"></div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="comment">// 允许在上下文子类中完成bean factory后处理</span></div><div class="line">                postProcessBeanFactory(beanFactory);</div><div class="line"></div><div class="line">                <span class="comment">// 调用上下文注册的bean factory处理器</span></div><div class="line">                invokeBeanFactoryPostProcessors(beanFactory);</div><div class="line"></div><div class="line">                <span class="comment">// 注册拦截bean创建的bean处理器</span></div><div class="line">                registerBeanPostProcessors(beanFactory);</div><div class="line"></div><div class="line">                <span class="comment">// 初始化上下文中消息源</span></div><div class="line">                initMessageSource();</div><div class="line"></div><div class="line">                <span class="comment">// 初始化上下文中的事件多播</span></div><div class="line">                initApplicationEventMulticaster();</div><div class="line"></div><div class="line">                <span class="comment">// 在特定上下文子类中初始化其他特殊bean</span></div><div class="line">                onRefresh();</div><div class="line"></div><div class="line">                <span class="comment">// 检查监听器bean并注册 </span></div><div class="line">                registerListeners();</div><div class="line"></div><div class="line">                <span class="comment">// 实例化所有剩余(non-lazy-init)单例</span></div><div class="line">                finishBeanFactoryInitialization(beanFactory);</div><div class="line"></div><div class="line">                <span class="comment">// 发布相应的事件</span></div><div class="line">                finishRefresh();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">catch</span> (BeansException ex) &#123;</div><div class="line">                logger.warn(&amp;quot;Exception encountered during context initialization - cancelling refresh attempt&amp;quot;, ex);</div><div class="line"></div><div class="line">                <span class="comment">// Destroy already created singletons to avoid dangling resources.</span></div><div class="line">                destroyBeans();</div><div class="line"></div><div class="line">                <span class="comment">// Reset 'active' flag.</span></div><div class="line">                cancelRefresh(ex);</div><div class="line"></div><div class="line">                <span class="comment">// Propagate exception to caller.</span></div><div class="line">                <span class="keyword">throw</span> ex;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>先把prepareRefresh的代码贴出来。这段代码主要功能是初始化<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</div><div class="line">	 * Prepare this context for refreshing, setting its startup date and</div><div class="line">	 * active flag as well as performing any initialization of property sources.</div><div class="line">	 */</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">prepareRefresh</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.startupDate = System.currentTimeMillis();</div><div class="line"></div><div class="line">		<span class="keyword">synchronized</span> (<span class="keyword">this</span>.activeMonitor) &#123;</div><div class="line">			<span class="keyword">this</span>.active = <span class="keyword">true</span>;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (logger.isInfoEnabled()) &#123;</div><div class="line">			logger.info(&amp;quot;Refreshing &amp;quot; + <span class="keyword">this</span>);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">// Initialize any placeholder property sources in the context environment</span></div><div class="line">		initPropertySources();</div><div class="line"></div><div class="line">		<span class="comment">// Validate that all properties marked as required are resolvable</span></div><div class="line">		<span class="comment">// see ConfigurablePropertyResolver#setRequiredProperties</span></div><div class="line">		getEnvironment().validateRequiredProperties();</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2015/05/11/Spring 使用简单Demo进行源码调试（三）/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/09/Spring 使用简单Demo进行源码调试（二）/" itemprop="url">
                  Spring 使用简单Demo进行源码调试（二）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-05-09T10:22:48+08:00" content="2015-05-09">
              2015-05-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Spring/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/05/09/Spring 使用简单Demo进行源码调试（二）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/05/09/Spring 使用简单Demo进行源码调试（二）/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2015/05/09/Spring 使用简单Demo进行源码调试（二）/" class="leancloud_visitors" data-flag-title="Spring 使用简单Demo进行源码调试（二）">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <!-- <span class="post-meta-item-text">阅读次数 </span> -->
               <span class="post-meta-item-text">❤ </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <blockquote>
<p>版权声明：本文为<a href="http://blog.jerkybible.com">博主</a>原创文章，<a href="http://blog.jerkybible.com">转载请注明出处</a>，谢谢!</p>
</blockquote>
<!-- indicate-the-source -->
<p>接上一篇文章 <a href="http://blog.jerkybible.com/2015/05/08/Spring 使用简单Demo进行源码调试（一）/">Spring 使用简单Demo进行源码调试（一）</a></p>
<p>在运行到下面语句<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(&amp;quot;bean.xml&amp;quot;);<span class="comment">// 读取bean.xml中的内容</span></div></pre></td></tr></table></figure></p>
<p>该构造函数首先进入下面ClassPathXmlApplicationContext类中这段代码。代码中configLocations为我们的配置文件，及[bean.xml]；refresh表示是否刷新，这里为true，表示刷新配置；parent表示上级上下文，这里为null表示没有上级上下文。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</div><div class="line">	 * 使用上一级上下文创建新的ClassPathXmlApplicationContext,</div><div class="line">	 * 从XML中加载定义</div><div class="line">	 * <span class="doctag">@param</span> configLocations 资源地址列表</div><div class="line">	 * <span class="doctag">@param</span> refresh 是否刷新上下文,</div><div class="line">	 * <span class="doctag">@param</span> parent 上一级上下文</div><div class="line">	 */</span></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ClassPathXmlApplicationContext</span><span class="params">(String[] configLocations, <span class="keyword">boolean</span> refresh, ApplicationContext parent)</span></div><div class="line">			<span class="keyword">throws</span> BeansException </span>&#123;			</div><div class="line">		<span class="comment">//parent = null;</span></div><div class="line">		<span class="comment">//refresh= true;</span></div><div class="line">		<span class="comment">//configLocations=[bean.xml];</span></div><div class="line">		<span class="keyword">super</span>(parent);</div><div class="line">		setConfigLocations(configLocations);</div><div class="line">		<span class="keyword">if</span> (refresh) &#123;</div><div class="line">			refresh();</div><div class="line">		&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2015/05/09/Spring 使用简单Demo进行源码调试（二）/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/08/Spring 使用简单Demo进行源码调试（一）/" itemprop="url">
                  Spring 使用简单Demo进行源码调试（一）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-05-08T06:33:01+08:00" content="2015-05-08">
              2015-05-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Spring/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/05/08/Spring 使用简单Demo进行源码调试（一）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/05/08/Spring 使用简单Demo进行源码调试（一）/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2015/05/08/Spring 使用简单Demo进行源码调试（一）/" class="leancloud_visitors" data-flag-title="Spring 使用简单Demo进行源码调试（一）">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <!-- <span class="post-meta-item-text">阅读次数 </span> -->
               <span class="post-meta-item-text">❤ </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <blockquote>
<p>版权声明：本文为<a href="http://blog.jerkybible.com">博主</a>原创文章，<a href="http://blog.jerkybible.com">转载请注明出处</a>，谢谢!</p>
</blockquote>
<!-- indicate-the-source -->
<p><strong>第一步</strong><br>在源码调试之前，需要将spring源码进行编译，这里选择的是3.2.x版本，这个版本在导入eclipse都会出现bug，但是不影响目前的调试。</p>
<p><strong>第二步</strong><br>将编译后的源码导入eclispe，如下图所示：<br><img src="/images/spring源码导入eclipse-242x300.png" alt="spring源码导入eclipse"><br>可以看到有两个工程报错，分别是spring—orm-hibernate4和spring-webmvc-tiles3，暂且不去管它，因为目前不会影响到后续的源码调试。</p>
<p><strong>第三步</strong><br>新建一个工程，Test，然后右键该工程，选择Build path -》 Configure Build Path…，然后把当前所有的没有报错的工程加入到Projects里，如下图所示：<br><img src="/images/加入未报错工程-300x234.png" alt="加入未报错工程"><br>
          <div class="post-more-link text-center">
            <a class="btn" href="/2015/05/08/Spring 使用简单Demo进行源码调试（一）/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/04/java实现文件操作/" itemprop="url">
                  java实现文件操作
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-05-04T09:57:38+08:00" content="2015-05-04">
              2015-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/05/04/java实现文件操作/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/05/04/java实现文件操作/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2015/05/04/java实现文件操作/" class="leancloud_visitors" data-flag-title="java实现文件操作">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <!-- <span class="post-meta-item-text">阅读次数 </span> -->
               <span class="post-meta-item-text">❤ </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1.java实现文件复制、剪切文件和删除<br>[java]<br>import java.io.File;<br>import java.io.FileInputStream;<br>import java.io.FileOutputStream;<br>import java.io.IOException;</p>
<p>/**</p>
<ul>
<li>Java实现文件复制、剪切、删除操作</li>
<li>文件指文件或文件夹</li>
<li>文件分割符统一用&quot;\&quot;<br>*/</li>
</ul>
<p>public class FileOperateDemo {</p>
<pre><code>/**
 * 复制文件或文件夹
 * @param srcPath 源文件或源文件夹的路径
 * @param destDir 目标文件所在的目录
 * @return
 */
public static boolean copyGeneralFile(String srcPath, String destDir) {
    boolean flag = false;
    File file = new File(srcPath);
    if(!file.exists()) { // 源文件或源文件夹不存在
        return false;
    }

    if(file.isFile()) {    // 文件复制
        flag = copyFile(srcPath, destDir);
    }
    else if(file.isDirectory()) { // 文件夹复制
        flag = copyDirectory(srcPath, destDir);
    }

    return flag;
}

/**
 * 默认的复制文件方法，默认会覆盖目标文件夹下的同名文件
 * @param srcPath
 *            源文件绝对路径
 * @param destDir
 *            目标文件所在目录
 * @return boolean
 */
public static boolean copyFile(String srcPath, String destDir) {
 return copyFile(srcPath, destDir, true/**overwriteExistFile*/); // 默认覆盖同名文件
}

/**
 * 默认的复制文件夹方法，默认会覆盖目标文件夹下的同名文件夹
 * @param srcPath    源文件夹路径
 * @param destPath    目标文件夹所在目录
 * @return boolean
 */
public static boolean copyDirectory(String srcPath, String destDir) {
 return copyDirectory(srcPath, destDir, true/**overwriteExistDir*/);
}

/**
 * 复制文件到目标目录
 * @param srcPath
 *            源文件绝对路径
 * @param destDir
 *            目标文件所在目录
 * @param overwriteExistFile
 *            是否覆盖目标目录下的同名文件
 * @return boolean
 */
public static boolean copyFile(String srcPath, String destDir, boolean overwriteExistFile) {
    boolean flag = false;

    File srcFile = new File(srcPath);
    if (!srcFile.exists() || !srcFile.isFile()) { // 源文件不存在
        return false;
    }

    //获取待复制文件的文件名
    String fileName = srcFile.getName();
    String destPath = destDir + File.separator +fileName;
    File destFile = new File(destPath);
    if (destFile.getAbsolutePath().equals(srcFile.getAbsolutePath())) { // 源文件路径和目标文件路径重复
        return false;
    }
    if(destFile.exists() &amp;amp;&amp;amp; !overwriteExistFile) {    // 目标目录下已有同名文件且不允许覆盖
        return false;
    }

    File destFileDir = new File(destDir);
    if(!destFileDir.exists() &amp;amp;&amp;amp; !destFileDir.mkdirs()) { // 目录不存在并且创建目录失败直接返回
     return false;
    }

    try {
        FileInputStream fis = new FileInputStream(srcPath);
        FileOutputStream fos = new FileOutputStream(destFile);
        byte[] buf = new byte[1024];
        int c;
        while ((c = fis.read(buf)) != -1) {
            fos.write(buf, 0, c);
        }
        fos.flush();
        fis.close();
        fos.close();

        flag = true;
    } catch (IOException e) {
        e.printStackTrace();
    }

    return flag;
}

/**
 * 
 * @param srcPath    源文件夹路径
 * @param destPath    目标文件夹所在目录
 * @return
 */
public static boolean copyDirectory(String srcPath, String destDir, boolean overwriteExistDir) {
    if(destDir.contains(srcPath))
       return false;
    boolean flag = false;

    File srcFile = new File(srcPath);
    if (!srcFile.exists() || !srcFile.isDirectory()) { // 源文件夹不存在
        return false;
    }

    //获得待复制的文件夹的名字，比如待复制的文件夹为&amp;quot;E:\\dir\\&amp;quot;则获取的名字为&amp;quot;dir&amp;quot;
    String dirName = srcFile.getName();

    //目标文件夹的完整路径
    String destDirPath = destDir + File.separator + dirName + File.separator;
    File destDirFile = new File(destDirPath);
    if(destDirFile.getAbsolutePath().equals(srcFile.getAbsolutePath())) {
     return false;
    }
    if(destDirFile.exists() &amp;amp;&amp;amp; destDirFile.isDirectory() &amp;amp;&amp;amp; !overwriteExistDir) {    // 目标位置有一个同名文件夹且不允许覆盖同名文件夹，则直接返回false
        return false;
    }

    if(!destDirFile.exists() &amp;amp;&amp;amp; !destDirFile.mkdirs()) {  // 如果目标目录不存在并且创建目录失败
     return false;
    }

    File[] fileList = srcFile.listFiles();    //获取源文件夹下的子文件和子文件夹
    if(fileList.length==0) {    // 如果源文件夹为空目录则直接设置flag为true，这一步非常隐蔽，debug了很久
        flag = true;
    }
    else {
        for(File temp: fileList) {
            if(temp.isFile()) {    // 文件
                flag = copyFile(temp.getAbsolutePath(), destDirPath, overwriteExistDir);     // 递归复制时也继承覆盖属性
            }
            else if(temp.isDirectory()) {    // 文件夹
                flag = copyDirectory(temp.getAbsolutePath(), destDirPath, overwriteExistDir);   // 递归复制时也继承覆盖属性
            }

            if(!flag) {
                break;
            }
        }
    }

    return flag;
}

/**
 * 删除文件或文件夹
 * @param path
 *            待删除的文件的绝对路径
 * @return boolean
 */
public static boolean deleteFile(String path) {
    boolean flag = false;

    File file = new File(path);
    if (!file.exists()) { // 文件不存在直接返回
        return flag;
    }
    flag = file.delete();

    return flag;
}

/**
 * 由上面方法延伸出剪切方法：复制+删除
 * @param  destDir 同上
 */
public static boolean cutGeneralFile(String srcPath, String destDir) {
 boolean flag = false;
    if(copyGeneralFile(srcPath, destDir) &amp;amp;&amp;amp; deleteFile(srcPath)) { // 复制和删除都成功
     flag = true;
    }

    return flag;
}

public static void main(String[] args) {
 /** 测试复制文件 */
 System.out.println(copyGeneralFile(&amp;quot;d://test/test.html&amp;quot;, &amp;quot;d://test/test/&amp;quot;));  // 一般正常场景
 System.out.println(copyGeneralFile(&amp;quot;d://notexistfile&amp;quot;, &amp;quot;d://test/&amp;quot;));      // 复制不存在的文件或文件夹
 System.out.println(copyGeneralFile(&amp;quot;d://test/test.html&amp;quot;, &amp;quot;d://test/&amp;quot;));      // 待复制文件与目标文件在同一目录下
 System.out.println(copyGeneralFile(&amp;quot;d://test/test.html&amp;quot;, &amp;quot;d://test/test/&amp;quot;));  // 覆盖目标目录下的同名文件
 System.out.println(copyFile(&amp;quot;d://test/&amp;quot;, &amp;quot;d://test2&amp;quot;, false)); // 不覆盖目标目录下的同名文件
 System.out.println(copyGeneralFile(&amp;quot;d://test/test.html&amp;quot;, &amp;quot;notexist://noexistdir/&amp;quot;)); // 复制文件到一个不可能存在也不可能创建的目录下

 System.out.println(&amp;quot;---------&amp;quot;);

 /** 测试复制文件夹 */
 System.out.println(copyGeneralFile(&amp;quot;d://test/&amp;quot;, &amp;quot;d://test2/&amp;quot;));

 System.out.println(&amp;quot;---------&amp;quot;);

 /** 测试删除文件 */
 System.out.println(deleteFile(&amp;quot;d://a/&amp;quot;));
}
</code></pre><p>}<br>[/java]</p>
<p>2.验证传入路径是否为正确的路径名(Windows系统，其他系统未使用)<br>[java]<br>// 验证字符串是否为正确路径名的正则表达式<br>private static String matches = &quot;[A-Za-z]:\\[^:?\&quot;&gt;&lt;<em>]</em>&quot;;<br>// 通过 sPath.matches(matches) 方法的返回值判断是否正确<br>// sPath 为路径字符串<br>[/java]</p>
<p>3.通用的文件夹或文件删除方法，直接调用此方法，即可实现删除文件夹或文件，包括文件夹下的所有文件<br>[java]<br>/** </p>
<ul>
<li>根据路径删除指定的目录或文件，无论存在与否<br><em>@param sPath  要删除的目录或文件 
</em>@return 删除成功返回 true，否则返回 false。<br>*/<br>public boolean DeleteFolder(String sPath) {<br>flag = false;<br>file = new File(sPath);<br>// 判断目录或文件是否存在<br>if (!file.exists()) {  // 不存在返回 false  <pre><code>return flag;  
</code></pre>} else {  <pre><code>// 判断是否为文件  
if (file.isFile()) {  // 为文件时调用删除文件方法  
    return deleteFile(sPath);  
} else {  // 为目录时调用删除目录方法  
    return deleteDirectory(sPath);  
}  
</code></pre>}<br>}<br>[/java]</li>
</ul>
<p>4.实现删除文件的方法，<br>[java]<br>/** </p>
<ul>
<li>删除单个文件 </li>
<li>@param   sPath    被删除文件的文件名 </li>
<li>@return 单个文件删除成功返回true，否则返回false<br>*/<br>public boolean deleteFile(String sPath) {<br> flag = false;<br> file = new File(sPath);<br> // 路径为文件且不为空则进行删除<br> if (file.isFile() &amp;&amp; file.exists()) {  <pre><code>file.delete();  
flag = true;  
</code></pre> }<br> return flag;<br>}<br>[/java]</li>
</ul>
<p>5.实现删除文件夹的方法，<br>[java]<br>/** </p>
<ul>
<li>删除目录（文件夹）以及目录下的文件 </li>
<li>@param   sPath 被删除目录的文件路径 </li>
<li>@return  目录删除成功返回true，否则返回false<br>*/<br>public boolean deleteDirectory(String sPath) {<br> //如果sPath不以文件分隔符结尾，自动添加文件分隔符<br> if (!sPath.endsWith(File.separator)) {  <pre><code>sPath = sPath + File.separator;  
</code></pre> }<br> File dirFile = new File(sPath);<br> //如果dir对应的文件不存在，或者不是一个目录，则退出<br> if (!dirFile.exists() || !dirFile.isDirectory()) {  <pre><code>return false;  
</code></pre> }<br> flag = true;<br> //删除文件夹下的所有文件(包括子目录)<br> File[] files = dirFile.listFiles();<br> for (int i = 0; i &lt; files.length; i++) {  <pre><code>//删除子文件  
if (files[i].isFile()) {  
    flag = deleteFile(files[i].getAbsolutePath());  
    if (!flag) break;  
} //删除子目录  
else {  
    flag = deleteDirectory(files[i].getAbsolutePath());  
    if (!flag) break;  
}  
</code></pre> }<br> if (!flag) return false;<br> //删除当前目录<br> if (dirFile.delete()) {  <pre><code>return true;  
</code></pre> } else {  <pre><code>return false;  
</code></pre> }<br>}<br>[/java] </li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/27/深入解析MySQL分区（Partition）功能/" itemprop="url">
                  深入解析MySQL分区（Partition）功能
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-27T09:15:01+08:00" content="2015-04-27">
              2015-04-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Mysql/" itemprop="url" rel="index">
                    <span itemprop="name">Mysql</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/04/27/深入解析MySQL分区（Partition）功能/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/04/27/深入解析MySQL分区（Partition）功能/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2015/04/27/深入解析MySQL分区（Partition）功能/" class="leancloud_visitors" data-flag-title="深入解析MySQL分区（Partition）功能">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <!-- <span class="post-meta-item-text">阅读次数 </span> -->
               <span class="post-meta-item-text">❤ </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Mysql自5.1开始对分区(Partition)有支持</p>
<p>= 水平分区（根据列属性按行分）=<br>举个简单例子：一个包含十年发票记录的表可以被分区为十个不同的分区，每个分区包含的是其中一年的记录。</p>
<p>=== 水平分区的几种模式：===</p>
<ul>
<li><p>Range（范围） – 这种模式允许DBA将数据划分不同范围。例如DBA可以将一个表通过年份划分成三个分区，80年代（1980’s）的数据，90年代（1990’s）的数据以及任何在2000年（包括2000年）后的数据。 </p>
</li>
<li><p>Hash（哈希） – 这中模式允许DBA通过对表的一个或多个列的Hash Key进行计算，最后通过这个Hash码不同数值对应的数据区域进行分区，。例如DBA可以建立一个对表主键进行分区的表。 </p>
</li>
<li><p>Key（键值） – 上面Hash模式的一种延伸，这里的Hash Key是MySQL系统产生的。 </p>
</li>
<li><p>List（预定义列表） – 这种模式允许系统通过DBA定义的列表的值所对应的行数据进行分割。例如：DBA建立了一个横跨三个分区的表，分别根据2004年2005年和2006年值所对应的数据。 </p>
</li>
<li><p>Composite（复合模式） - 很神秘吧，哈哈，其实是以上模式的组合使用而已，就不解释了。举例：在初始化已经进行了Range范围分区的表上，我们可以对其中一个分区再进行hash哈希分区。 </p>
</li>
</ul>
<p>= 垂直分区（按列分）=<br>举个简单例子：一个包含了大text和BLOB列的表，这些text和BLOB列又不经常被访问，这时候就要把这些不经常使用的text和BLOB了划分到另一个分区，在保证它们数据相关性的同时还能提高访问速度。</p>
<p>[分区表和未分区表试验过程]</p>
<p>*创建分区表,按日期的年份拆分<br>[sql]<br>CREATE TABLE part_tab ( c1 int default NULL, c2 varchar(30) default NULL, c3 date default NULL) engine=myisam<br>PARTITION BY RANGE (year(c3)) (PARTITION p0 VALUES LESS THAN (1995),<br>PARTITION p1 VALUES LESS THAN (1996) , PARTITION p2 VALUES LESS THAN (1997) ,<br>PARTITION p3 VALUES LESS THAN (1998) , PARTITION p4 VALUES LESS THAN (1999) ,<br>PARTITION p5 VALUES LESS THAN (2000) , PARTITION p6 VALUES LESS THAN (2001) ,<br>PARTITION p7 VALUES LESS THAN (2002) , PARTITION p8 VALUES LESS THAN (2003) ,<br>PARTITION p9 VALUES LESS THAN (2004) , PARTITION p10 VALUES LESS THAN (2010),<br>PARTITION p11 VALUES LESS THAN MAXVALUE );  [/sql]<br>注意最后一行，考虑到可能的最大值</p>
<p>*创建未分区表<br>[sql]<br>mysql&gt; create table no_part_tab (c1 int(11) default NULL,c2 varchar(30) default NULL,c3 date default NULL) engine=myisam;<br>[/sql]</p>
<p><em>通过存储过程灌入800万条测试数据<br>mysql&gt; set sql_mode=’’; /</em> 如果创建存储过程失败，则先需设置此变量, bug? <em>/<br>mysql&gt; delimiter //   /</em> 设定语句终结符为 //，因存储过程语句用;结束 */</p>
<p>[sql]<br>mysql&gt; CREATE PROCEDURE load_part_tab()<br>       begin<br>    declare v int default 0;<br>    while v &lt; 8000000<br>    do<br>        insert into part_tab<br>        values (v,’testing partitions’,adddate(‘1995-01-01’,(rand(v)<em>36520) mod 3652));<br>         set v = v + 1;<br>    end while;<br>    end<br>    //<br>mysql&gt; delimiter ;<br>mysql&gt; call load_part_tab();<br>Query OK, 1 row affected (8 min 17.75 sec)<br>[sql] view plaincopy<br>mysql&gt; insert into no_part_tab select </em> from part_tab;<br>Query OK, 8000000 rows affected (51.59 sec)<br>Records: 8000000 Duplicates: 0 Warnings: 0<br>[/sql]</p>
<ul>
<li>测试SQL性能</li>
</ul>
<p>[sql]<br>mysql&gt; select count(<em>) from part_tab where c3 &gt; date ‘1995-01-01’ and c3 &lt; date ‘1995-12-31’;<br>+———-+<br>| count(</em>) |<br>+———-+<br>|   795181 |<br>+———-+<br>1 row in set (0.55 sec)<br>[/sql]</p>
<p>[sql]<br>mysql&gt; select count(<em>) from no_part_tab where c3 &gt; date ‘1995-01-01’ and c3 &lt; date ‘1995-12-31’;<br>+———-+<br>| count(</em>) |<br>+———-+<br>|   795181 |<br>+———-+<br>1 row in set (4.69 sec)[/sql]<br>结果表明分区表比未分区表的执行时间少90%。</p>
<ul>
<li>通过explain语句来分析执行情况<br>[sql]<br>mysql &gt; explain select count(<em>) from no_part_tab where c3 &gt; date ‘1995-01-01’ and c3 &lt; date ‘1995-12-31’\G<br>/</em> 结尾的\G使得mysql的输出改为列模式 <em>/<br><strong><strong><strong><strong><strong><strong>**</strong></strong></strong></strong></strong></strong></em> 1. row <strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong><pre><code>id: 1
</code></pre>select_type: SIMPLE<pre><code>table: no_part_tab
 type: ALL
</code></pre>possible_keys: NULL<pre><code>    key: NULL
key_len: NULL
    ref: NULL
   rows: 8000000
  Extra: Using where
</code></pre>1 row in set (0.00 sec)<br>[/sql]</li>
</ul>
<p>[sql]<br>mysql&gt; explain select count(<em>) from part_tab where c3 &gt; date ‘1995-01-01’ and c3 &lt; date ‘1995-12-31’\G<br><strong><strong><strong><strong><strong><strong>**</strong></strong></strong></strong></strong></strong></em> 1. row <strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong><br>           id: 1<br>select_type: SIMPLE<br>        table: part_tab<br>         type: ALL<br>possible_keys: NULL<br>          key: NULL<br>      key_len: NULL<br>          ref: NULL<br>         rows: 798458<br>        Extra: Using where<br>1 row in set (0.00 sec)[/sql]<br>explain语句显示了SQL查询要处理的记录数目</p>
<ul>
<li><p>试验创建索引后情况<br>[sql]<br>mysql&gt; create index idx_of_c3 on no_part_tab (c3);<br>Query OK, 8000000 rows affected (1 min 18.08 sec)<br>Records: 8000000 Duplicates: 0 Warnings: 0<br>[/sql]<br>[sql]<br>mysql&gt; create index idx_of_c3 on part_tab (c3);<br>Query OK, 8000000 rows affected (1 min 19.19 sec)<br>Records: 8000000 Duplicates: 0 Warnings: 0[/sql]<br>创建索引后的数据库文件大小列表：<br>2008-05-24 09:23             8,608 no_part_tab.frm<br>2008-05-24 09:24       255,999,996 no_part_tab.MYD<br>2008-05-24 09:24        81,611,776 no_part_tab.MYI<br>2008-05-24 09:25                 0 part_tab#P#p0.MYD<br>2008-05-24 09:26             1,024 part_tab#P#p0.MYI<br>2008-05-24 09:26        25,550,656 part_tab#P#p1.MYD<br>2008-05-24 09:26         8,148,992 part_tab#P#p1.MYI<br>2008-05-24 09:26        25,620,192 part_tab#P#p10.MYD<br>2008-05-24 09:26         8,170,496 part_tab#P#p10.MYI<br>2008-05-24 09:25                 0 part_tab#P#p11.MYD<br>2008-05-24 09:26             1,024 part_tab#P#p11.MYI<br>2008-05-24 09:26        25,656,512 part_tab#P#p2.MYD<br>2008-05-24 09:26         8,181,760 part_tab#P#p2.MYI<br>2008-05-24 09:26        25,586,880 part_tab#P#p3.MYD<br>2008-05-24 09:26         8,160,256 part_tab#P#p3.MYI<br>2008-05-24 09:26        25,585,696 part_tab#P#p4.MYD<br>2008-05-24 09:26         8,159,232 part_tab#P#p4.MYI<br>2008-05-24 09:26        25,585,216 part_tab#P#p5.MYD<br>2008-05-24 09:26         8,159,232 part_tab#P#p5.MYI<br>2008-05-24 09:26        25,655,740 part_tab#P#p6.MYD<br>2008-05-24 09:26         8,181,760 part_tab#P#p6.MYI<br>2008-05-24 09:26        25,586,528 part_tab#P#p7.MYD<br>2008-05-24 09:26         8,160,256 part_tab#P#p7.MYI<br>2008-05-24 09:26        25,586,752 part_tab#P#p8.MYD<br>2008-05-24 09:26         8,160,256 part_tab#P#p8.MYI<br>2008-05-24 09:26        25,585,824 part_tab#P#p9.MYD<br>2008-05-24 09:26         8,159,232 part_tab#P#p9.MYI<br>2008-05-24 09:25             8,608 part_tab.frm<br>2008-05-24 09:25                68 part_tab.par</p>
</li>
<li><p>再次测试SQL性能</p>
</li>
</ul>
<p>[sql]<br>mysql&gt; select count(<em>) from no_part_tab where c3 &gt; date ‘1995-01-01’ and c3 &lt; date ‘1995-12-31’;<br>+———-+<br>| count(</em>) |<br>+———-+<br>|   795181 |<br>+———-+<br>1 row in set (2.42 sec)   /<em> 为原来4.69 sec 的51%</em>/<br>[/sql]</p>
<p>重启mysql ( net stop mysql, net start mysql)后，查询时间降为0.89 sec,几乎与分区表相同。</p>
<p>[sql]<br>mysql&gt; select count(<em>) from part_tab where c3 &gt; date ‘1995-01-01’ and c3 &lt; date ‘1995-12-31’;<br>+———-+<br>| count(</em>) |<br>+———-+<br>|   795181 |<br>+———-+<br>1 row in set (0.86 sec)<br>[/sql]</p>
<ul>
<li>更进一步的试验<br><em>* 增加日期范围<br>[sql]<br>mysql&gt; select count(</em>) from no_part_tab where c3 &gt; date ‘1995-01-01’ and c3 &lt; date ‘1997-12-31’;<br>+———-+<br>| count(<em>) |<br>+———-+<br>| 2396524 |<br>+———-+<br>1 row in set (5.42 sec)<br>[/sql]<br>[sql]<br>mysql&gt; select count(</em>) from part_tab where c3 &gt; date ‘1995-01-01’ and c3 &lt; date ‘1997-12-31’;<br>+———-+<br>| count(*) |<br>+———-+<br>| 2396524 |<br>+———-+<br>1 row in set (2.63 sec)<br>[/sql]</li>
</ul>
<p><em>* 增加未索引字段查询<br>[sql]<br>mysql&gt; select count(</em>) from part_tab where c3 &gt; date ‘1995-01-01’ and c3 &lt; date<br>‘1996-12-31’ and c2=’hello’;<br>+———-+<br>| count(<em>) |<br>+———-+<br>|        0 |<br>+———-+<br>1 row in set (0.75 sec)<br>[/sql]<br>[sql]<br>mysql&gt; select count(</em>) from no_part_tab where c3 &gt; date ‘1995-01-01’ and c3 &lt; date ‘1996-12-31’ and c2=’hello’;<br>+———-+<br>| count(*) |<br>+———-+<br>|        0 |<br>+———-+<br>1 row in set (11.52 sec)<br>[/sql]</p>
<p>= 初步结论 =</p>
<ul>
<li>分区和未分区占用文件空间大致相同 （数据和索引文件）</li>
<li>如果查询语句中有未建立索引字段，分区时间远远优于未分区时间</li>
<li>如果查询语句中字段建立了索引，分区和未分区的差别缩小，分区略优于未分区。</li>
</ul>
<p>= 最终结论 =</p>
<ul>
<li>对于大数据量，建议使用分区功能。</li>
<li>去除不必要的字段</li>
<li>根据手册， 增加myisam_max_sort_file_size 会增加分区性能</li>
</ul>
<p>[分区命令详解]</p>
<p>= 分区例子 = </p>
<ul>
<li><p>RANGE 类型<br>[sql]<br>CREATE TABLE users (  </p>
<pre><code>uid INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,  
name VARCHAR(30) NOT NULL DEFAULT &apos;&apos;,  
email VARCHAR(30) NOT NULL DEFAULT &apos;&apos;  
</code></pre><p>)<br>PARTITION BY RANGE (uid) (  </p>
<pre><code>PARTITION p0 VALUES LESS THAN (3000000)  
DATA DIRECTORY = &apos;/data0/data&apos;  
INDEX DIRECTORY = &apos;/data1/idx&apos;,  

PARTITION p1 VALUES LESS THAN (6000000)  
DATA DIRECTORY = &apos;/data2/data&apos;  
INDEX DIRECTORY = &apos;/data3/idx&apos;,  

PARTITION p2 VALUES LESS THAN (9000000)  
DATA DIRECTORY = &apos;/data4/data&apos;  
INDEX DIRECTORY = &apos;/data5/idx&apos;,  

PARTITION p3 VALUES LESS THAN MAXVALUE     DATA DIRECTORY = &apos;/data6/data&apos;   
INDEX DIRECTORY = &apos;/data7/idx&apos;  
</code></pre><p>);  [/sql]<br>在这里，将用户表分成4个分区，以每300万条记录为界限，每个分区都有自己独立的数据、索引文件的存放目录，与此同时，这些目录所在的物理磁盘分区可能也都是完全独立的，可以提高磁盘IO吞吐量。</p>
</li>
<li><p>LIST 类型<br>[sql]<br>CREATE TABLE category (<br>   cid INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,<br>   name VARCHAR(30) NOT NULL DEFAULT ‘’<br>)<br>PARTITION BY LIST (cid) (<br>   PARTITION p0 VALUES IN (0,4,8,12)<br>   DATA DIRECTORY = ‘/data0/data’<br>   INDEX DIRECTORY = ‘/data1/idx’,  </p>
<p>   PARTITION p1 VALUES IN (1,5,9,13)<br>   DATA DIRECTORY = ‘/data2/data’<br>   INDEX DIRECTORY = ‘/data3/idx’,  </p>
<p>   PARTITION p2 VALUES IN (2,6,10,14)<br>   DATA DIRECTORY = ‘/data4/data’<br>   INDEX DIRECTORY = ‘/data5/idx’,  </p>
<p>   PARTITION p3 VALUES IN (3,7,11,15)<br>   DATA DIRECTORY = ‘/data6/data’<br>   INDEX DIRECTORY = ‘/data7/idx’<br>);    [/sql]<br>分成4个区，数据文件和索引文件单独存放。</p>
</li>
<li><p>HASH 类型<br>[sql]<br>CREATE TABLE users (<br>   uid INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,<br>   name VARCHAR(30) NOT NULL DEFAULT ‘’,<br>   email VARCHAR(30) NOT NULL DEFAULT ‘’<br>)<br>PARTITION BY HASH (uid) PARTITIONS 4 (<br>   PARTITION p0<br>   DATA DIRECTORY = ‘/data0/data’<br>   INDEX DIRECTORY = ‘/data1/idx’,  </p>
<p>   PARTITION p1<br>   DATA DIRECTORY = ‘/data2/data’<br>   INDEX DIRECTORY = ‘/data3/idx’,  </p>
<p>   PARTITION p2<br>   DATA DIRECTORY = ‘/data4/data’<br>   INDEX DIRECTORY = ‘/data5/idx’,  </p>
<p>   PARTITION p3<br>   DATA DIRECTORY = ‘/data6/data’<br>   INDEX DIRECTORY = ‘/data7/idx’<br>);  [/sql]<br>分成4个区，数据文件和索引文件单独存放。</p>
</li>
</ul>
<p>例子：<br>[sql]<br>CREATE TABLE ti2 (id INT, amount DECIMAL(7,2), tr_date DATE)<br>    ENGINE=myisam<br>    PARTITION BY HASH( MONTH(tr_date) )<br>    PARTITIONS 6;  </p>
<p>CREATE PROCEDURE load_ti2()<br>       begin<br>    declare v int default 0;<br>    while v &lt; 80000<br>    do<br>        insert into ti2<br>        values (v,’3.14’,adddate(‘1995-01-01’,(rand(v)*3652) mod 365));<br>         set v = v + 1;<br>    end while;<br>    end<br>    //<br>[/sql]</p>
<ul>
<li><p>KEY 类型<br>[sql]<br>CREATE TABLE users (<br>   uid INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,<br>   name VARCHAR(30) NOT NULL DEFAULT ‘’,<br>   email VARCHAR(30) NOT NULL DEFAULT ‘’<br>)<br>PARTITION BY KEY (uid) PARTITIONS 4 (<br>   PARTITION p0<br>   DATA DIRECTORY = ‘/data0/data’<br>   INDEX DIRECTORY = ‘/data1/idx’,  </p>
<p>   PARTITION p1<br>   DATA DIRECTORY = ‘/data2/data’<br>   INDEX DIRECTORY = ‘/data3/idx’,  </p>
<p>   PARTITION p2<br>   DATA DIRECTORY = ‘/data4/data’<br>   INDEX DIRECTORY = ‘/data5/idx’,  </p>
<p>   PARTITION p3<br>   DATA DIRECTORY = ‘/data6/data’<br>   INDEX DIRECTORY = ‘/data7/idx’<br>); [/sql]<br>分成4个区，数据文件和索引文件单独存放。</p>
</li>
<li><p>子分区<br>子分区是针对 RANGE/LIST 类型的分区表中每个分区的再次分割。再次分割可以是 HASH/KEY 等类型。例如：<br>[sql]<br>CREATE TABLE users (<br>   uid INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,<br>   name VARCHAR(30) NOT NULL DEFAULT ‘’,<br>   email VARCHAR(30) NOT NULL DEFAULT ‘’<br>)<br>PARTITION BY RANGE (uid) SUBPARTITION BY HASH (uid % 4) SUBPARTITIONS 2(<br>   PARTITION p0 VALUES LESS THAN (3000000)<br>   DATA DIRECTORY = ‘/data0/data’<br>   INDEX DIRECTORY = ‘/data1/idx’,  </p>
<p>   PARTITION p1 VALUES LESS THAN (6000000)<br>   DATA DIRECTORY = ‘/data2/data’<br>   INDEX DIRECTORY = ‘/data3/idx’<br>);  [/sql]<br>对 RANGE 分区再次进行子分区划分，子分区采用 HASH 类型。<br>或者<br>[sql]<br>CREATE TABLE users (<br>   uid INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,<br>   name VARCHAR(30) NOT NULL DEFAULT ‘’,<br>   email VARCHAR(30) NOT NULL DEFAULT ‘’<br>)<br>PARTITION BY RANGE (uid) SUBPARTITION BY KEY(uid) SUBPARTITIONS 2(<br>   PARTITION p0 VALUES LESS THAN (3000000)<br>   DATA DIRECTORY = ‘/data0/data’<br>   INDEX DIRECTORY = ‘/data1/idx’,  </p>
<p>   PARTITION p1 VALUES LESS THAN (6000000)<br>   DATA DIRECTORY = ‘/data2/data’<br>   INDEX DIRECTORY = ‘/data3/idx’<br>);  [/sql]<br>对 RANGE 分区再次进行子分区划分，子分区采用 KEY 类型。</p>
</li>
</ul>
<p>= 分区管理 =</p>
<pre><code>* 删除分区  
</code></pre><p>[sql]<br>ALERT TABLE users DROP PARTITION p0;  [/sql]<br>      删除分区 p0。</p>
<pre><code>* 重建分区
      o RANGE 分区重建
</code></pre><p>[sql]<br>ALTER TABLE users REORGANIZE PARTITION p0,p1 INTO (PARTITION p0 VALUES LESS THAN (6000000));  [/sql]<br>            将原来的 p0,p1 分区合并起来，放到新的 p0 分区中。<br>          o LIST 分区重建<br>[sql]<br>ALTER TABLE users REORGANIZE PARTITION p0,p1 INTO (PARTITION p0 VALUES IN(0,1,4,5,8,9,12,13));  [/sql]<br>            将原来的 p0,p1 分区合并起来，放到新的 p0 分区中。<br>          o HASH/KEY 分区重建<br>[sql]<br>ALTER TABLE users REORGANIZE PARTITION COALESCE PARTITION 2;  [/sql]<br>            用 REORGANIZE 方式重建分区的数量变成2，在这里数量只能减少不能增加。想要增加可以用 ADD PARTITION 方法。</p>
<pre><code>* 新增分区
      o 新增 RANGE 分区   
</code></pre><p>[sql]<br>ALTER TABLE category ADD PARTITION (PARTITION p4 VALUES IN (16,17,18,19)<br>           DATA DIRECTORY = ‘/data8/data’<br>           INDEX DIRECTORY = ‘/data9/idx’);  [/sql]<br>            新增一个RANGE分区。<br>          o 新增 HASH/KEY 分区<br>[sql]<br>ALTER TABLE users ADD PARTITION PARTITIONS 8;  [/sql]<br>            将分区总数扩展到8个。</p>
<p>[ 给已有的表加上分区 ]<br>[sql]<br>alter table results partition by RANGE (month(ttime))<br>(PARTITION p0 VALUES LESS THAN (1),<br>PARTITION p1 VALUES LESS THAN (2) , PARTITION p2 VALUES LESS THAN (3) ,<br>PARTITION p3 VALUES LESS THAN (4) , PARTITION p4 VALUES LESS THAN (5) ,<br>PARTITION p5 VALUES LESS THAN (6) , PARTITION p6 VALUES LESS THAN (7) ,<br>PARTITION p7 VALUES LESS THAN (8) , PARTITION p8 VALUES LESS THAN (9) ,<br>PARTITION p9 VALUES LESS THAN (10) , PARTITION p10 VALUES LESS THAN (11),<br>PARTITION p11 VALUES LESS THAN (12),<br>PARTITION P12 VALUES LESS THAN (13) );   [/sql]</p>
<p>默认分区限制分区字段必须是主键（PRIMARY KEY)的一部分，为了去除此<br>限制：<br>[方法1] 使用ID<br>[sql]<br>mysql&gt; ALTER TABLE np_pk<br>    -&gt;     PARTITION BY HASH( TO_DAYS(added) )<br>    -&gt;     PARTITIONS 4;<br>ERROR 1503 (HY000): A PRIMARY KEY must include all columns in the table’s partitioning function<br>[/sql]<br>However, this statement using the id column for the partitioning column is valid, as shown here:</p>
<p>[sql]<br>mysql&gt; ALTER TABLE np_pk<br>    -&gt;     PARTITION BY HASH(id)<br>    -&gt;     PARTITIONS 4;<br>Query OK, 0 rows affected (0.11 sec)<br>Records: 0 Duplicates: 0 Warnings: 0<br>[/sql]<br>[方法2] 将原有PK去掉生成新PK<br>[sql]<br>mysql&gt; alter table results drop PRIMARY KEY;<br>Query OK, 5374850 rows affected (7 min 4.05 sec)<br>Records: 5374850 Duplicates: 0 Warnings: 0<br>[/sql]<br>[sql]<br>mysql&gt; alter table results add PRIMARY KEY(id, ttime);<br>Query OK, 5374850 rows affected (6 min 14.86 sec)<br>Records: 5374850 Duplicates: 0 Warnings: 0<br>[/sql]</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/22/Linux 面试/" itemprop="url">
                  Linux 面试
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-22T14:02:42+08:00" content="2015-04-22">
              2015-04-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/Interview/" itemprop="url" rel="index">
                    <span itemprop="name">Interview</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/04/22/Linux 面试/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/04/22/Linux 面试/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2015/04/22/Linux 面试/" class="leancloud_visitors" data-flag-title="Linux 面试">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <!-- <span class="post-meta-item-text">阅读次数 </span> -->
               <span class="post-meta-item-text">❤ </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1. linux文件系统都有三个身份Owner, group, others， 每种身份都有r，w，x三种权限。<br>2. /etc/passwd 存有系统的用户信息，/etc/shadow存有用户的密码，/etc/group 存有组的情况。<br>3. 更改权限的三个命令：chmod, chgrp, chown<br>对于文件来说：r–读取文件内容；w–编辑、新增文件（不可删除）；x-可执行<br>umask 决定新建文件或文件夹的权限，显示的值为需要去掉的权限<br>对于目录来说：r–使用ls查看目录文件；w–创建、删除、移动、重命名文件；x-可使用cd切换目录<br>4. /sbin/service, /sbin/ifconfig默认状况下只有root用户才能直接使用<br>5.路径：. ， .. ，~<br>6. 目录有关的操作：cd，pwd，mkdir， rmdir<br>7.文件操作：ls，cp，rm，mv，touch<br>8.文件查阅：cat/tac， nl，more，less。head，tail<br>9.查看文件类型：file<br>10.查找脚本：which 查找文件名： whereis， locate， find<br>find -name -type -user -exec ls  {} \;<br>11. 添加用户useradd；用户组groupadd<br>用户查询：w/who 用户通讯：mesg，write，wall<br>批量添加用户和密码：useradd user；echo user | passwd –stdin user<br>12. 磁盘有关命令：df/du 查看磁盘； fdisk -l查看磁盘分区；fsck系统检查；mount挂载磁盘，新建目录，挂载磁盘分区；umount卸载磁盘<br>13. 打包 tar -czvf， 解压tar -xzvf<br>14.Vim编辑器使用<br>15.正则表达式和grep<br>16. awk，sed<br>17. Shell脚本<br>18.程序管理：<br>查看 进程 ps -ef | grep pname ps aux<br>后台运行&amp;<br>后台暂停：ctr+z<br>查看后台进程： jobs -l<br>恢复前台 fg %jobnumber<br>后台运行：bg %jobnumber<br>脱机运行：nohup<br>查看动态进程：top<br>强制杀死进程：kill -9 pid<br>19. 查看内存： free -m；查看内核：uname -a；跟踪网络 netstat -a -tlnp<br>20. /etc/init.d/<em> 系统启动脚本<br>     /etc/</em>  系统配置<br>     /var/lib/* 各服务产生的数据库<br>     service name start/stop/restart/status<br>     chkconfig –list –add 开机启动 防火墙 iptables<br>     /var/log 系统日志文件<br>21. 软件安装：rqm -ivh | -aq| -e ；yum install </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/22/vim下ctags使用/" itemprop="url">
                  vim下ctags使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-22T14:01:23+08:00" content="2015-04-22">
              2015-04-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/04/22/vim下ctags使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/04/22/vim下ctags使用/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2015/04/22/vim下ctags使用/" class="leancloud_visitors" data-flag-title="vim下ctags使用">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <!-- <span class="post-meta-item-text">阅读次数 </span> -->
               <span class="post-meta-item-text">❤ </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1. cd to the root directory of your code:<br>2.Run Ctags recursively over the entire code to generate the tags file<br>ctags -R *<br>3. To search for a specific tag and open Vim to its definition, run the following command in your shell:<br>vim -t <tag><br>4. Or, open any Linux source file in Vim and use the following basic commands:<br>Ctrl-] Jump to the tag underneath the cursor<br>:ts <tag> <ret> Search for a particular tag<br>:tn Go to the next definition for the last tag<br>:tp Go to the previous definition for the last tag<br>:ts List all of the definitions of the last tag<br>Ctrl-t Jump back up in the tag stack<br>The first command is probably the one you will use most often: it jumps to the definition of the tag (function name, structure name, variable name, or pretty much anything) under the cursor. The second command can be used to search for any tag, regardless of the file that is currently opened. If there are multiple definitions/uses for a particular tag, the tn and tp commands can be used to scroll through them, and the ts command can be used to “search” a list for the definition you want (useful when there are dozens or hundreds of definitions for some commonly-used struct). Finally, the last command is used to jump back up in the tag stack to the location you initiated the previous tag search from.</ret></tag></tag></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/21/Ganglia 安装/" itemprop="url">
                  Ganglia 安装
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-21T14:09:28+08:00" content="2015-04-21">
              2015-04-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Operation-And-Maintenance/" itemprop="url" rel="index">
                    <span itemprop="name">Operation And Maintenance</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/04/21/Ganglia 安装/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/04/21/Ganglia 安装/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2015/04/21/Ganglia 安装/" class="leancloud_visitors" data-flag-title="Ganglia 安装">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <!-- <span class="post-meta-item-text">阅读次数 </span> -->
               <span class="post-meta-item-text">❤ </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1. Install prerequisites on server node</p>
<p>Step 0: Use yum to install dependency</p>
<h1 id="yum-y-install-apr-devel-apr-util-check-devel-cairo-devel-pango-devel-libxml2-devel-glib2-devel-dbus-devel-freetype-devel-fontconfig-devel-gcc-c-expat-devel-python-devel-libXrender-devel-zlib-libpng-freetype-libjpeg-fontconfig-gd-libxml2-pcre-pcre-devel"><a href="#yum-y-install-apr-devel-apr-util-check-devel-cairo-devel-pango-devel-libxml2-devel-glib2-devel-dbus-devel-freetype-devel-fontconfig-devel-gcc-c-expat-devel-python-devel-libXrender-devel-zlib-libpng-freetype-libjpeg-fontconfig-gd-libxml2-pcre-pcre-devel" class="headerlink" title="yum -y install apr-devel apr-util check-devel cairo-devel pango-devel libxml2-devel glib2-devel dbus-devel freetype-devel fontconfig-devel gcc-c++ expat-devel python-devel libXrender-devel zlib libpng freetype libjpeg fontconfig gd libxml2 pcre pcre-devel"></a>yum -y install apr-devel apr-util check-devel cairo-devel pango-devel libxml2-devel glib2-devel dbus-devel freetype-devel fontconfig-devel gcc-c++ expat-devel python-devel libXrender-devel zlib libpng freetype libjpeg fontconfig gd libxml2 pcre pcre-devel</h1><p>Step 1: Install libconfuse</p>
<h1 id="wget-http-savannah-nongnu-org-download-confuse-confuse-2-7-tar-gz"><a href="#wget-http-savannah-nongnu-org-download-confuse-confuse-2-7-tar-gz" class="headerlink" title="wget http://savannah.nongnu.org/download/confuse/confuse-2.7.tar.gz"></a>wget <a href="http://savannah.nongnu.org/download/confuse/confuse-2.7.tar.gz" target="_blank" rel="external">http://savannah.nongnu.org/download/confuse/confuse-2.7.tar.gz</a></h1><h1 id="tar-xzvf-confuse-2-7-tar-gz"><a href="#tar-xzvf-confuse-2-7-tar-gz" class="headerlink" title="tar -xzvf confuse-2.7.tar.gz"></a>tar -xzvf confuse-2.7.tar.gz</h1><h1 id="cd-confuse-2-7"><a href="#cd-confuse-2-7" class="headerlink" title="cd confuse-2.7"></a>cd confuse-2.7</h1><h1 id="configure-CFLAGS-fPIC-–disable-nls-amp-amp-make-amp-amp-make-install"><a href="#configure-CFLAGS-fPIC-–disable-nls-amp-amp-make-amp-amp-make-install" class="headerlink" title="./configure CFLAGS=-fPIC –disable-nls &amp;&amp; make &amp;&amp; make install"></a>./configure CFLAGS=-fPIC –disable-nls &amp;&amp; make &amp;&amp; make install</h1><p>Step 2: Install rrdtool on server node</p>
<h1 id="wget-http-oss-oetiker-ch-rrdtool-pub-rrdtool-1-4-7-tar-gz"><a href="#wget-http-oss-oetiker-ch-rrdtool-pub-rrdtool-1-4-7-tar-gz" class="headerlink" title="wget http://oss.oetiker.ch/rrdtool/pub/rrdtool-1.4.7.tar.gz"></a>wget <a href="http://oss.oetiker.ch/rrdtool/pub/rrdtool-1.4.7.tar.gz" target="_blank" rel="external">http://oss.oetiker.ch/rrdtool/pub/rrdtool-1.4.7.tar.gz</a></h1><h1 id="tar-xzvf-rrdtool-1-4-7-tar-gz"><a href="#tar-xzvf-rrdtool-1-4-7-tar-gz" class="headerlink" title="tar -xzvf rrdtool-1.4.7.tar.gz"></a>tar -xzvf rrdtool-1.4.7.tar.gz</h1><h1 id="cd-rrdtool-1-4-7"><a href="#cd-rrdtool-1-4-7" class="headerlink" title="cd rrdtool-1.4.7"></a>cd rrdtool-1.4.7</h1><h1 id="configure-–prefix-usr-lib64-rrdtool-–disable-perl"><a href="#configure-–prefix-usr-lib64-rrdtool-–disable-perl" class="headerlink" title="./configure –prefix=/usr/lib64/rrdtool –disable-perl"></a>./configure –prefix=/usr/lib64/rrdtool –disable-perl</h1><h1 id="make-amp-amp-make-install"><a href="#make-amp-amp-make-install" class="headerlink" title="make &amp;&amp; make install"></a>make &amp;&amp; make install</h1><p>Step 3(Optional): Install libpre</p>
<h1 id="wget-http-downloads-sourceforge-net-pcre-pcre-8-32-tar-bz2"><a href="#wget-http-downloads-sourceforge-net-pcre-pcre-8-32-tar-bz2" class="headerlink" title="wget  http://downloads.sourceforge.net/pcre/pcre-8.32.tar.bz2"></a>wget  <a href="http://downloads.sourceforge.net/pcre/pcre-8.32.tar.bz2" target="_blank" rel="external">http://downloads.sourceforge.net/pcre/pcre-8.32.tar.bz2</a></h1><h1 id="tar-xvf-pcre-8-32-tar-bz2"><a href="#tar-xvf-pcre-8-32-tar-bz2" class="headerlink" title="tar -xvf pcre-8.32.tar.bz2"></a>tar -xvf pcre-8.32.tar.bz2</h1><h1 id="cd-pcre-8-32"><a href="#cd-pcre-8-32" class="headerlink" title="cd pcre-8.32"></a>cd pcre-8.32</h1><h1 id="configure-amp-amp-make-amp-amp-make-install"><a href="#configure-amp-amp-make-amp-amp-make-install" class="headerlink" title="./configure &amp;&amp; make &amp;&amp; make install"></a>./configure &amp;&amp; make &amp;&amp; make install</h1><p>2. Install and configure gmetad&amp;gmond on server node</p>
<p>Step 0: Install ganglia code</p>
<h1 id="wget-http-sourceforge-net-projects-ganglia-files-latest-download-source-files"><a href="#wget-http-sourceforge-net-projects-ganglia-files-latest-download-source-files" class="headerlink" title="wget http://sourceforge.net/projects/ganglia/files/latest/download?source=files"></a>wget <a href="http://sourceforge.net/projects/ganglia/files/latest/download?source=files" target="_blank" rel="external">http://sourceforge.net/projects/ganglia/files/latest/download?source=files</a></h1><h1 id="tar-xzvf-ganglia-3-5-0-tar-gz"><a href="#tar-xzvf-ganglia-3-5-0-tar-gz" class="headerlink" title="tar -xzvf ganglia-3.5.0.tar.gz"></a>tar -xzvf ganglia-3.5.0.tar.gz</h1><h1 id="cd-ganglia-3-5-0"><a href="#cd-ganglia-3-5-0" class="headerlink" title="cd ganglia-3.5.0"></a>cd ganglia-3.5.0</h1><h1 id="configure-–with-gmetad-–with-librrd-usr-lib64-rrdtool-–sysconfdir-etc-ganglia"><a href="#configure-–with-gmetad-–with-librrd-usr-lib64-rrdtool-–sysconfdir-etc-ganglia" class="headerlink" title="./configure –with-gmetad –with-librrd=/usr/lib64/rrdtool –sysconfdir=/etc/ganglia"></a>./configure –with-gmetad –with-librrd=/usr/lib64/rrdtool –sysconfdir=/etc/ganglia</h1><p>Ganglia can not be compiled successfully until the information as below shows up.<br>Welcome to..</p>
<pre><code> ______                  ___
/ ____/___ _____  ____ _/ (_)___ _
</code></pre><p>   / / <strong>/ </strong> <code>/ __ \/ __</code>/ / / <strong> `/<br>  / /<em>/ / /</em>/ / / / / /<em>/ / / / /</em>/ /<br>  __</strong>/_<em>,</em>/<em>/ /</em>/_<em>, /</em>/<em>/__,</em>/<br>                   /<em>__</em>/</p>
<p>Copyright (c) 2005 University of California, Berkeley</p>
<h1 id="make-amp-amp-make-install-1"><a href="#make-amp-amp-make-install-1" class="headerlink" title="make &amp;&amp; make install"></a>make &amp;&amp; make install</h1><p>Step 1: Check gmetad&amp;gmond binary</p>
<h1 id="which-gmetric"><a href="#which-gmetric" class="headerlink" title="which gmetric"></a>which gmetric</h1><p>/usr/local/bin/gmetric</p>
<h1 id="which-gmond"><a href="#which-gmond" class="headerlink" title="which gmond"></a>which gmond</h1><p>/usr/local/sbin/gmond</p>
<h1 id="which-gmetad"><a href="#which-gmetad" class="headerlink" title="which gmetad"></a>which gmetad</h1><p>/usr/local/sbin/gmetad</p>
<p>Step 2: Customize data_source name and hosts in gmetad.conf</p>
<h1 id="vi-etc-ganglia-gmetad-conf"><a href="#vi-etc-ganglia-gmetad-conf" class="headerlink" title="vi /etc/ganglia/gmetad.conf"></a>vi /etc/ganglia/gmetad.conf</h1><p>data_source “cluster1” mdw # provide the name of host containing all data, better more than one if a cluster, default port number is 8649</p>
<p>Step 3: Generate &amp;&amp; Customize gmond.conf(Using unicast)</p>
<h1 id="gmond-–default-config-gt-etc-ganglia-gmond-conf"><a href="#gmond-–default-config-gt-etc-ganglia-gmond-conf" class="headerlink" title="gmond –default_config &gt; /etc/ganglia/gmond.conf"></a>gmond –default_config &gt; /etc/ganglia/gmond.conf</h1><p>At this point you may get this error</p>
<p>gmond: error while loading shared libraries: libpcre.so.1: cannot open shared object file: No such file or directory</p>
<p>Create a symlink and execute the command again</p>
<h1 id="ln-s-lib64-libpcre-so-0-lib64-libpcre-so-1"><a href="#ln-s-lib64-libpcre-so-0-lib64-libpcre-so-1" class="headerlink" title="ln -s /lib64/libpcre.so.0 /lib64/libpcre.so.1"></a>ln -s /lib64/libpcre.so.0 /lib64/libpcre.so.1</h1><h1 id="vi-etc-ganglia-gmond-conf"><a href="#vi-etc-ganglia-gmond-conf" class="headerlink" title="vi /etc/ganglia/gmond.conf"></a>vi /etc/ganglia/gmond.conf</h1><p>cluster {<br>  name = “cluster1” # use the cluster name defined in gmetad.conf<br>  owner = “unspecified”<br>  latlong = “unspecified”<br>  url = “unspecified”<br>}<br>udp_send_channel {</p>
<p>  #bind_hostname = yes # Highly recommended, soon to be default.</p>
<pre><code># This option tells gmond to use a source address
# that resolves to the machine&apos;s hostname.  Without
# this, the metrics may appear to come from any
# interface and the DNS names associated with
# those IPs will be used to create the RRDs.
</code></pre><p>  host = 172.28.8.250 #if using unicast, provide ip address of server node, host and mcast_join cannot be in a channel<br>  port = 8649<br>  ttl = 1<br>}</p>
<p>udp_recv_channel {</p>
<p>  #mcast_join = 239.2.11.71 don’t need to provide multicast address if using unicast<br>  port = 8649</p>
<h1 id="bind-239-2-11-71"><a href="#bind-239-2-11-71" class="headerlink" title="bind = 239.2.11.71"></a>bind = 239.2.11.71</h1><p>  #retry_bind = true<br>}<br>Step 4: Create rrd directory, change permissions</p>
<h1 id="mkdir-p-var-lib-ganglia-rrds"><a href="#mkdir-p-var-lib-ganglia-rrds" class="headerlink" title="mkdir -p /var/lib/ganglia/rrds"></a>mkdir -p /var/lib/ganglia/rrds</h1><h1 id="chown-nobody-nobody-var-lib-ganglia-R"><a href="#chown-nobody-nobody-var-lib-ganglia-R" class="headerlink" title="chown nobody:nobody /var/lib/ganglia/ -R"></a>chown nobody:nobody /var/lib/ganglia/ -R</h1><p>Step 5: Copy the init script &amp;&amp; binary to corresponding directory</p>
<h1 id="cp-gmetad-gmetad-init-etc-rc-d-init-d-gmetad"><a href="#cp-gmetad-gmetad-init-etc-rc-d-init-d-gmetad" class="headerlink" title="cp gmetad/gmetad.init /etc/rc.d/init.d/gmetad"></a>cp gmetad/gmetad.init /etc/rc.d/init.d/gmetad</h1><h1 id="cp-usr-local-sbin-gmetad-usr-sbin"><a href="#cp-usr-local-sbin-gmetad-usr-sbin" class="headerlink" title="cp /usr/local/sbin/gmetad /usr/sbin/"></a>cp /usr/local/sbin/gmetad /usr/sbin/</h1><h1 id="cp-gmond-gmond-init-etc-rc-d-init-d-gmond"><a href="#cp-gmond-gmond-init-etc-rc-d-init-d-gmond" class="headerlink" title="cp gmond/gmond.init /etc/rc.d/init.d/gmond"></a>cp gmond/gmond.init /etc/rc.d/init.d/gmond</h1><h1 id="cp-usr-local-sbin-gmond-usr-sbin"><a href="#cp-usr-local-sbin-gmond-usr-sbin" class="headerlink" title="cp /usr/local/sbin/gmond /usr/sbin/"></a>cp /usr/local/sbin/gmond /usr/sbin/</h1><p>Step 6: Start gmetad and gmond service</p>
<h1 id="chkconfig-–add-gmetad"><a href="#chkconfig-–add-gmetad" class="headerlink" title="chkconfig –add gmetad"></a>chkconfig –add gmetad</h1><h1 id="chkconfig-–add-gmond"><a href="#chkconfig-–add-gmond" class="headerlink" title="chkconfig –add gmond"></a>chkconfig –add gmond</h1><h1 id="chkconfig-gmetad-on"><a href="#chkconfig-gmetad-on" class="headerlink" title="chkconfig gmetad on"></a>chkconfig gmetad on</h1><h1 id="chkconfig-gmond-on"><a href="#chkconfig-gmond-on" class="headerlink" title="chkconfig gmond on"></a>chkconfig gmond on</h1><h1 id="service-gmetad-start"><a href="#service-gmetad-start" class="headerlink" title="service gmetad start"></a>service gmetad start</h1><h1 id="service-gmond-start"><a href="#service-gmond-start" class="headerlink" title="service gmond start"></a>service gmond start</h1><p>3. Install and configure gmond on client node</p>
<p>Put Ganglia on the compute nodes by just copying a few files. This is something you can add to a post install script.<br>Step 0: Create a file with all your host names.<br>Step 1: Change paths of libraries and run ganglia install script.</p>
<h1 id="cat-home-gpadmin-yum-install-ganglia-install-sh"><a href="#cat-home-gpadmin-yum-install-ganglia-install-sh" class="headerlink" title="cat /home/gpadmin/yum_install/ganglia_install.sh"></a>cat /home/gpadmin/yum_install/ganglia_install.sh</h1><p>#!/bin/sh</p>
<p>for i in <code>cat /home/gpadmin/yum_install/hosts_nomaster</code>; do<br>    scp /usr/sbin/gmond $i:/usr/sbin/gmond<br>    ssh $i mkdir -p /etc/ganglia/<br>    scp /etc/ganglia/gmond.conf $i:/etc/ganglia/<br>    scp /etc/init.d/gmond $i:/etc/init.d/<br>    scp /usr/local/lib64/libganglia-3.5.0.so.0 $i:/usr/local/lib64/<br>    scp /usr/lib64/libexpat.so.0 $i:/usr/lib64/<br>    scp /usr/local/lib/libconfuse.a $i:/usr/local/lib/<br>    scp /usr/lib64/libapr-1.so.0 $i:/usr/lib64/<br>    scp -r /usr/local/lib64/ganglia/ $i:/usr/local/lib64/ganglia/<br>    ssh $i service gmond start<br>done</p>
<p>4. Install web front-end on server node</p>
<p>Step 0: Install prerequisites</p>
<h1 id="yum-install-httpd-php"><a href="#yum-install-httpd-php" class="headerlink" title="yum install httpd php"></a>yum install httpd php</h1><p>Step 1: Install ganglia-web binary</p>
<h1 id="wget-http-downloads-sourceforge-net-project-ganglia-ganglia-web-3-5-2-ganglia-web-3-5-2-tar-gz-r-http-3A-2F-2Fsourceforge-net-2Fprojects-2Fganglia-2Ffiles-2Fganglia-web-2F3-5-2-2F-amp-ts-1347011991-amp-use-mirror-cdnetworks-kr-1"><a href="#wget-http-downloads-sourceforge-net-project-ganglia-ganglia-web-3-5-2-ganglia-web-3-5-2-tar-gz-r-http-3A-2F-2Fsourceforge-net-2Fprojects-2Fganglia-2Ffiles-2Fganglia-web-2F3-5-2-2F-amp-ts-1347011991-amp-use-mirror-cdnetworks-kr-1" class="headerlink" title="wget http://downloads.sourceforge.net/project/ganglia/ganglia-web/3.5.2/ganglia-web-3.5.2.tar.gz?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fganglia%2Ffiles%2Fganglia-web%2F3.5.2%2F&amp;ts=1347011991&amp;use_mirror=cdnetworks-kr-1"></a>wget <a href="http://downloads.sourceforge.net/project/ganglia/ganglia-web/3.5.2/ganglia-web-3.5.2.tar.gz?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fganglia%2Ffiles%2Fganglia-web%2F3.5.2%2F&amp;ts=1347011991&amp;use_mirror=cdnetworks-kr-1" target="_blank" rel="external">http://downloads.sourceforge.net/project/ganglia/ganglia-web/3.5.2/ganglia-web-3.5.2.tar.gz?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fganglia%2Ffiles%2Fganglia-web%2F3.5.2%2F&amp;ts=1347011991&amp;use_mirror=cdnetworks-kr-1</a></h1><h1 id="tar-xzvf-ganglia-web-3-5-2-tar-gz"><a href="#tar-xzvf-ganglia-web-3-5-2-tar-gz" class="headerlink" title="tar -xzvf ganglia-web-3.5.2.tar.gz"></a>tar -xzvf ganglia-web-3.5.2.tar.gz</h1><h1 id="cd-ganglia-web-3-5-2"><a href="#cd-ganglia-web-3-5-2" class="headerlink" title="cd ganglia-web-3.5.2"></a>cd ganglia-web-3.5.2</h1><h1 id="make-amp-amp-make-install-2"><a href="#make-amp-amp-make-install-2" class="headerlink" title="make &amp;&amp; make install"></a>make &amp;&amp; make install</h1><p>Step 2: Configure rrdtool path</p>
<h1 id="vi-var-www-html-ganglia-conf-default-php"><a href="#vi-var-www-html-ganglia-conf-default-php" class="headerlink" title="vi /var/www/html/ganglia/conf_default.php"></a>vi /var/www/html/ganglia/conf_default.php</h1><p>$conf[‘rrdtool’] = “/usr/lib64/rrdtool/bin/rrdtool”;</p>
<p>Step 3: Visit ganglia web interface through  “<a href="http://server-ip/ganglia" target="_blank" rel="external">http://server-ip/ganglia</a>“</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/21/Postgres 源码学习/" itemprop="url">
                  Postgre 源码学习
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-21T14:08:02+08:00" content="2015-04-21">
              2015-04-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Postgre/" itemprop="url" rel="index">
                    <span itemprop="name">Postgre</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/04/21/Postgres 源码学习/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/04/21/Postgres 源码学习/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2015/04/21/Postgres 源码学习/" class="leancloud_visitors" data-flag-title="Postgre 源码学习">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <!-- <span class="post-meta-item-text">阅读次数 </span> -->
               <span class="post-meta-item-text">❤ </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1. 首先， 我选择eclipse CDT作为开发工具，很简单， 在Help-&gt;Install New Software中输入一下网址安装插件即可<br><a href="http://download.eclipse.org/tools/cdt/releases/helios" target="_blank" rel="external">http://download.eclipse.org/tools/cdt/releases/helios</a></p>
<p>2. 下载postgres源码，配置、编译、安装<br>Step 2.1 在终端对PostgreSQL进行配置将目录切换到PostgreSQL源码的根目录，执行如下命令：<br>    cd postgresql-9.2.2<br>    ./configure –prefix=$HOME/project –enable-depend –enable-cassert –enable-debug<br>其中–prefix指定PostgreSQL要安装的目录 （这个目录可以任意指定，但是建议使用绝对路径，这样在后续开发过程中不会出现因路径问题而产生的一系列莫名其妙的问题） –enable-depend、 –enable-cassert及 –enable-debug</p>
<p>Step 2.2 编译PostgreSQL<br>打开Eclipse将PostgreSQL源码导入Eclipse的工作目录，选择File–&gt;import，选择Existing Code as Makefile Project， 然后点击Next,在下面的图示中选择PostgreSQL源码所在的目录，并为工程文件起一个项目名，并选择编译器<br>由于PostgreSQL是使用C编写的，所以也要把C++勾掉，只保留C，然后点击Finish,等待工程导入完毕，这里需要注意的是只有当工程完全导入之后才可以执行下面的操作，否可可能出现错误，（可以通过Eclipse右下角查看当前导入进度）。当工程完全导入之后没有出现错误，则表明PostgreSQL编译成功</p>
<p>Step 2.3  安装PostgreSQL<br>在导入的工程上右键选择Make Targets 然后选择Create，在Make Target选项卡中双击install进行安装，Eclipse控制台中出现“Postgres Installation Complete” 表明PostgreSQL安装成功。</p>
<p>3. 初始化Postgres<br>Step 3.1 此时的PostgreSQL还不能真正使用，还需要进行初始化，在终端中执行如下操作：<br>     export PATH=$HOME/postgresql-9.2.2/bin:$PATH<br>     export PGDATA=DemoDir<br>     initdb</p>
<p>Step 3.2 在Eclipse中项目上右键选择Run As–&gt;Run Configurations，双击C/C++ Application，在Main选项卡中点击Search Project选择Postgres点击Apply。然后再切换到Arguments选项卡，输入参数：-D DemoDir（即上面命令中PGDATA指定的路径）。点击Run，如果看到如下信息表示安装成功。<br>LOG:  database system is ready to accept connections<br>LOG:  autovacuum launcher started</p>
<p>4.  初始Postgres<br>在终端输入：<br>createdb DemoDB<br>psql -l<br>psql DemoDB</p>
<p>5. 在Eclipse中调试PostgreSQL源代码</p>
<p>如果要调试PostgreSQL源码，首先保证安装了gdb，之后在工程上右键，选择Debug  As–&gt;Local C/C++ Application,在弹出的窗口中选择postgres，点击OK, 这时我们就可以通过Eclipse调试PostgreSQL源码了</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/34/">34</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Jerky Lu" />
          <p class="site-author-name" itemprop="name">Jerky Lu</p>
          <p class="site-description motion-element" itemprop="description">戒急用忍</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">337</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">42</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">60</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/luzheqi1987" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/jerkybible" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://lqcode.com/" title="李琼写文章的地方" target="_blank">李琼写文章的地方</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://wiredtiger.org/" title="落影流年" target="_blank">落影流年</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://koihik.github.io/" title="Koihik's Blog" target="_blank">Koihik's Blog</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jerky Lu</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="http://resource.qn.jerkybible.com/blog/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="http://resource.qn.jerkybible.com/blog/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="http://resource.qn.jerkybible.com/blog/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="http://resource.qn.jerkybible.com/blog/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="http://resource.qn.jerkybible.com/blog/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="http://resource.qn.jerkybible.com/blog/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"jerkybible"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="http://resource.qn.jerkybible.com/blog/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("ikggGroaejtGnK5kN7meiyXz-gzGzoHsz", "xE9HyNGqt0oKWPxB4mz6HScq");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
  
  
    

  
  
  
  <link rel="stylesheet" href="http://resource.qn.jerkybible.com/blog/vendors/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="http://resource.qn.jerkybible.com/blog/vendors/algolia-instant-search/instantsearch.min.js"></script>
  

  <script type="text/javascript" src="/js/src/algolia.js?v=5.0.1"></script>



  

</body>
</html>
